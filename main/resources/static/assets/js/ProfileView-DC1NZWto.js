import{x as a,aC as e,X as s,r as l,c as t,k as n,z as i,A as d,u as r,C as o,M as c,I as u,ak as v,aD as p,O as m,a4 as y,V as b,K as f,y as h}from"./vue-vendor-DbIISveR.js";import{r as g,u as k}from"../index-CK1BbKi4.js";import{g as D,a as w,b as j,u as x}from"./employee-Dqt5o1ra.js";import{E as V}from"./element-plus-C89kzd44.js";import{_ as I}from"./_plugin-vue_export-helper-BCo6x5W8.js";const C={class:"profile"},U={class:"profile-header"},O={class:"avatar-section"},_={class:"avatar-container"},S=["src"],q={class:"avatar-upload"},M={class:"upload-icon"},T=["disabled"],z={class:"employee-id"},A={class:"profile-content"},E={class:"card-header"},F=["disabled"],K={class:"info-grid"},L={class:"info-item"},N={key:1},P={class:"info-item"},X={key:1},B={class:"info-item"},G={key:1},H={class:"info-item"},J={class:"card-header"},Q=["disabled"],R=["value"],W={class:"salary-details"},Y={class:"salary-item"},Z={class:"amount"},$={class:"salary-item"},aa={class:"amount"},ea={class:"salary-item"},sa={class:"amount"},la={class:"salary-item"},ta={class:"amount"},na={class:"salary-item"},ia={class:"amount"},da={class:"salary-item"},ra={class:"amount"},oa={class:"salary-item total"},ca={class:"amount"},ua={class:"attendance-list"},va={class:"date"},pa={class:"time"},ma={class:"profile-card"},ya={class:"card-header"},ba=["disabled"],fa={class:"leave-list"},ha={class:"leave-info"},ga={class:"leave-type"},ka={class:"leave-date"},Da={key:0,class:"dialog-overlay"},wa={class:"dialog"},ja={class:"form-group"},xa={class:"form-group"},Va={class:"form-group"},Ia={class:"form-group"},Ca={class:"dialog-buttons"},Ua=["disabled"],Oa=["disabled"],_a=I(a({__name:"ProfileView",setup(a){const I=k(),{userInfo:_a}=e(I),Sa=s({employeeId:"",name:"",username:"",department:"",position:"",joinDate:"",status:"active"}),qa=s({basic:!1}),Ma=l((new Date).toISOString().slice(0,7)),Ta=Array.from({length:6},((a,e)=>{const s=new Date;return s.setMonth(s.getMonth()-e),s.toISOString().slice(0,7)})),za=s({base:0,performance:0,overtime:0,attendance:0,insurance:0,tax:0}),Aa=t((()=>{const{base:a,performance:e,overtime:s,attendance:l,insurance:t,tax:n}=za;return a+e+s+l-t-n})),Ea=l([]),Fa=l([]),Ka=l(!1),La=s({type:"annual",startDate:"",endDate:"",reason:""}),Na=s({profile:!1,salary:!1,attendance:!1,avatar:!1,leave:!1}),Pa=async()=>{var a,e;if(null==(a=_a.value)?void 0:a.id)try{Na.leave=!0,await(e={...La,userId:_a.value.id},g.post("/employee/leave-request",e)),Ka.value=!1,Object.assign(La,{type:"annual",startDate:"",endDate:"",reason:""}),V.success("请假申请提交成功")}catch(s){V.error("提交请假申请失败")}finally{Na.leave=!1}},Xa=a=>new Date(a).toLocaleDateString("zh-CN");n((()=>{(async()=>{var a;if(null==(a=_a.value)?void 0:a.id)try{Na.profile=!0;const{data:a}=await D(_a.value.id);Object.assign(Sa,a)}catch(e){V.error("获取个人信息失败")}finally{Na.profile=!1}})(),(async()=>{var a;if(null==(a=_a.value)?void 0:a.id)try{Na.salary=!0;const{data:a}=await w(_a.value.id);Object.assign(za,a)}catch(e){V.error("获取工资信息失败")}finally{Na.salary=!1}})(),(async()=>{var a;if(null==(a=_a.value)?void 0:a.id)try{Na.attendance=!0;const{data:a}=await j(_a.value.id);Ea.value=a}catch(e){V.error("获取考勤记录失败")}finally{Na.attendance=!1}})()}));const Ba=async a=>{var e;const s=a.target;if(null==(e=s.files)?void 0:e.length)try{Na.avatar=!0;const a=s.files[0],{data:e}=await(a=>{const e=new FormData;return e.append("avatar",a),g.post("/employee/upload/avatar",e,{headers:{"Content-Type":"multipart/form-data"}})})(a);_a.value&&(_a.value.avatar=e.url),V.success("头像上传成功")}catch(l){V.error("头像上传失败")}finally{Na.avatar=!1}},Ga=async()=>{qa.basic?await(async()=>{var a;if(null==(a=_a.value)?void 0:a.id)try{await x({...Sa,id:_a.value.id,status:Sa.status}),qa.basic=!1,V.success("个人信息更新成功")}catch(e){V.error("更新个人信息失败")}})():qa.basic=!0};return(a,e)=>{var s,l;return h(),i("div",C,[d("div",U,[d("div",O,[d("div",_,[d("img",{src:(null==(s=r(_a))?void 0:s.avatar)||"/default-avatar.png",class:"avatar"},null,8,S),d("div",q,[d("label",{for:"avatar-input",class:o(["upload-label",{loading:Na.avatar}])},[d("i",M,c(Na.avatar?"⌛":"📷"),1)],2),d("input",{type:"file",id:"avatar-input",accept:"image/*",onChange:Ba,class:"hidden",disabled:Na.avatar},null,40,T)])]),d("h2",null,c(null==(l=r(_a))?void 0:l.username),1),d("p",z,"工号："+c(Sa.employeeId),1)])]),d("div",A,[d("div",{class:o(["profile-card",{loading:Na.profile}])},[d("div",E,[e[10]||(e[10]=d("h3",null,"基本信息",-1)),d("button",{onClick:Ga,class:"edit-button",disabled:Na.profile},c(qa.basic?"保存":"编辑"),9,F)]),d("div",K,[d("div",L,[e[11]||(e[11]=d("label",null,"姓名",-1)),qa.basic?u((h(),i("input",{key:0,"onUpdate:modelValue":e[0]||(e[0]=a=>Sa.name=a),class:"edit-input"},null,512)),[[v,Sa.name]]):(h(),i("span",N,c(Sa.name),1))]),d("div",P,[e[12]||(e[12]=d("label",null,"部门",-1)),qa.basic?u((h(),i("input",{key:0,"onUpdate:modelValue":e[1]||(e[1]=a=>Sa.department=a),class:"edit-input",disabled:""},null,512)),[[v,Sa.department]]):(h(),i("span",X,c(Sa.department),1))]),d("div",B,[e[13]||(e[13]=d("label",null,"职位",-1)),qa.basic?u((h(),i("input",{key:0,"onUpdate:modelValue":e[2]||(e[2]=a=>Sa.position=a),class:"edit-input",disabled:""},null,512)),[[v,Sa.position]]):(h(),i("span",G,c(Sa.position),1))]),d("div",H,[e[14]||(e[14]=d("label",null,"入职日期",-1)),d("span",null,c(Xa(Sa.joinDate)),1)])])],2),d("div",{class:o(["profile-card",{loading:Na.salary}])},[d("div",J,[e[15]||(e[15]=d("h3",null,"工资信息",-1)),u(d("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>Ma.value=a),class:"month-select",disabled:Na.salary},[(h(!0),i(m,null,y(r(Ta),(a=>(h(),i("option",{key:a,value:a},c(a),9,R)))),128))],8,Q),[[p,Ma.value]])]),d("div",W,[d("div",Y,[e[16]||(e[16]=d("span",{class:"label"},"基本工资",-1)),d("span",Z,"¥"+c(za.base),1)]),d("div",$,[e[17]||(e[17]=d("span",{class:"label"},"绩效工资",-1)),d("span",aa,"¥"+c(za.performance),1)]),d("div",ea,[e[18]||(e[18]=d("span",{class:"label"},"加班工资",-1)),d("span",sa,"¥"+c(za.overtime),1)]),d("div",la,[e[19]||(e[19]=d("span",{class:"label"},"满勤奖励",-1)),d("span",ta,"¥"+c(za.attendance),1)]),d("div",na,[e[20]||(e[20]=d("span",{class:"label"},"社保扣除",-1)),d("span",ia,"-¥"+c(za.insurance),1)]),d("div",da,[e[21]||(e[21]=d("span",{class:"label"},"个税扣除",-1)),d("span",ra,"-¥"+c(za.tax),1)]),d("div",oa,[e[22]||(e[22]=d("span",{class:"label"},"实发工资",-1)),d("span",ca,"¥"+c(Aa.value),1)])])],2),d("div",{class:o(["profile-card",{loading:Na.attendance}])},[e[23]||(e[23]=d("div",{class:"card-header"},[d("h3",null,"考勤记录")],-1)),d("div",ua,[(h(!0),i(m,null,y(Ea.value,(a=>(h(),i("div",{key:a.date,class:"attendance-item"},[d("span",va,c(a.date),1),d("span",{class:o(["status",a.status])},c(a.statusText),3),d("span",pa,c(a.checkIn)+" - "+c(a.checkOut),1)])))),128))])],2),d("div",ma,[d("div",ya,[e[24]||(e[24]=d("h3",null,"请假记录",-1)),d("button",{onClick:e[4]||(e[4]=a=>Ka.value=!0),class:"add-button",disabled:Na.leave}," 申请请假 ",8,ba)]),d("div",fa,[(h(!0),i(m,null,y(Fa.value,(a=>(h(),i("div",{key:a.id,class:"leave-item"},[d("div",ha,[d("span",ga,c(a.type),1),d("span",ka,c(Xa(a.startDate))+" 至 "+c(Xa(a.endDate)),1)]),d("span",{class:o(["leave-status",a.status])},c(a.statusText),3)])))),128))])])]),Ka.value?(h(),i("div",Da,[d("div",wa,[e[30]||(e[30]=d("h3",null,"请假申请",-1)),d("form",{onSubmit:b(Pa,["prevent"])},[d("div",ja,[e[26]||(e[26]=d("label",null,"请假类型",-1)),u(d("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>La.type=a),required:""},e[25]||(e[25]=[d("option",{value:"annual"},"年假",-1),d("option",{value:"sick"},"病假",-1),d("option",{value:"personal"},"事假",-1)]),512),[[p,La.type]])]),d("div",xa,[e[27]||(e[27]=d("label",null,"开始日期",-1)),u(d("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=a=>La.startDate=a),required:""},null,512),[[v,La.startDate]])]),d("div",Va,[e[28]||(e[28]=d("label",null,"结束日期",-1)),u(d("input",{type:"date","onUpdate:modelValue":e[7]||(e[7]=a=>La.endDate=a),required:""},null,512),[[v,La.endDate]])]),d("div",Ia,[e[29]||(e[29]=d("label",null,"请假原因",-1)),u(d("textarea",{"onUpdate:modelValue":e[8]||(e[8]=a=>La.reason=a),required:""},null,512),[[v,La.reason]])]),d("div",Ca,[d("button",{type:"button",onClick:e[9]||(e[9]=a=>Ka.value=!1),disabled:Na.leave}," 取消 ",8,Ua),d("button",{type:"submit",disabled:Na.leave},c(Na.leave?"提交中...":"提交"),9,Oa)])],32)])])):f("",!0)])}}}),[["__scopeId","data-v-6e45eed5"]]);export{_a as default};
